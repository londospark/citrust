# Orchestration: Toad (Tester)
**Timestamp:** 2026-02-22T014200Z  
**Task:** Unit tests + benchmarks (#7, #9)  
**Outcome:** SUCCESS

## Summary
Toad implemented comprehensive unit test suite and benchmark infrastructure for Phase 1 crypto modules.

## Deliverables
- **19 unit tests** (all passing) across keys.rs, crypto.rs, ncsd.rs, ncch.rs
- **Criterion benchmarks** in benches/crypto_bench.rs for:
  - rol128 edge cases
  - derive_normal_key throughput
  - aes_ctr_decrypt (1MB, 16MB buffers)
  - Full key derivation pipeline
- **compare.ps1** PowerShell script for Rust vs Python timing with SHA256 verification

## Architecture Decisions
- **Test placement:** Inline `#[cfg(test)]` modules (not separate tests/ directory) for locality and private function testing
- **Test vectors:** NIST SP 800-38A for AES-CTR validation; synthetic 512-byte NCSD/NCCH headers for parsing tests
- **Test coverage:**
  - keys.rs: CryptoMethod mapping, constants validation, key_x_for_method correctness
  - crypto.rs: rol128 edge cases, derive_normal_key known vectors, AES-128-CTR
  - ncsd.rs: Header parsing, magic validation, sector size, partition helpers
  - ncch.rs: Header parsing, crypto detection, flags, IV construction

## Impact
- All tests pass, enabling safe refactoring and optimization
- Benchmarks provide baseline for Phase 2/3 performance improvements
- compare.ps1 enables direct Rust vs Python timing on real ROMs

## Next Steps (Issue #8)
- Integration tests: round-trip encryption/decryption with test fixtures
- Consider property-based tests (quickcheck/proptest) for crypto functions
